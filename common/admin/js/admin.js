/*Copyright JianJuKe.cn*/function stopDefault(a){return a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,!1}function refreshPage(){window.location.reload(),window.setTimeout("refreshPage()",1500)}function selectAttaches(a,b,c){var d='<div id="imgsDialogHolder"><div id="imgsTagsHolder"></div><div id="imgsHolder" class="imgsHolder"></div></div>';$("#imgsHolder").length?"none"===$("#myDialog").css("display")&&$("#myDialog").modal("show"):(dialog({msg:d,title:"选择图片",modalSize:"modal-lg"}),ajaxTags(b,"site")),c?floatParams=c:c=floatParams;var e="";$("#imgsTagsHolder input[type=checkbox]:checked").each(function(){e+=$(this).val()+","});var f=$(".albums-holder .active").attr("data-id"),g={YII_CSRF_TOKEN:zmf.csrfToken,from:b?b:"",tagids:e,album:f?f:0};a||(a=zmf.ajaxAttachesUrl),$.post(a,g,function(a){a=$.parseJSON(a),ajaxReturn=!0,1===a.status?($("#imgsHolder").html(a.html),$("#imgsHolder a").unbind("click").click(function(){var a=$(this),d=a.attr("data-id");if(!d)return!1;var e=a.attr("data-original"),f=a.children("img").attr("src");if("avatar"===b)$("#"+c.inputId).val(d),$("#"+c.targetHolder).attr("src",f);else if("posts"===b){var g='<div class="thumbnail col-xs-4 col-sm-4 attach-item" id="uploadAttach'+d+'"><span class="right-bar"><a title="删除图片" class="del-btn" href="javascript:;" onclick="$(\'#uploadAttach'+d+'\').remove()"><i class="fa fa-remove"></i></a><a title="设置为封面图" onclick="setPostFaceimg(\''+d+"',this,'"+f+"','"+e+'\')" class="face-btn" href="javascript:;"><i class="fa fa-bookmark-o"></i></a></span><img src="'+f+'" class="img-responsive"><input type="hidden" name="attaches[img'+d+'][type]" value="img"><textarea class="form-control" placeholder="点击添加图片描述" name="attaches[img'+d+'][desc]"></textarea></div>';$("#"+c.targetHolder).append(g)}else if("article"===b){var h="<p><img src='"+e+"/c650.jpg' data='"+d+"' class='img-responsive'/><br/></p>";myeditor.execCommand("inserthtml",h)}})):simpleDialog({msg:a.msg})})}function ajaxTags(a,b){var c={YII_CSRF_TOKEN:zmf.csrfToken};$.post(zmf.ajaxTagsUrl,c,function(c){c=$.parseJSON(c),1===c.status&&($("#imgsTagsHolder").html(c.html),$("#imgsTagsHolder input[type=checkbox]").on("change",function(){var c=$(this),d=c.val(),e=c.attr("data-title"),f='<a href="javascript:;" id="selected_tags_a_'+d+'" class="label label-info" onclick="$(\'#tagid-'+d+"').click()\">"+e+'<i class="fa fa-remove"></i></a>';c.hasClass("selected")?(c.removeClass("selected"),$("#selected_tags_a_"+d).remove()):(c.addClass("selected"),$("#selectedTags-holder").append(f)),"site"===b?selectAttaches(!1,a,!1):selectZoneImgs(!1,a,!1)}),$(".albums-holder .album-item").unbind("click").click(function(){$(this).siblings().removeClass("active"),$(this).toggleClass("active"),"site"===b?selectAttaches(!1,a,!1):selectZoneImgs(!1,a,!1)}))})}function _searchThisTag(a){var b='<span class="tags-item" id="select-this-tag-'+a[1]+'" onclick="_removeThisTag('+a[1]+')"><input value="'+a[1]+'" type="checkbox" name="tags[]" checked="checked">'+a[0]+"</span>";$("#select-this-tag-"+a[1]).length>0?simpleDialog({msg:"已添加"}):$("#add-tags-box").append(b)}function _removeThisTag(a){$("#select-this-tag-"+a).remove()}function autoMatchTags(){var a="";$(".autoLinkTagContent").each(function(){a+=$(this).val()+","}),a+=myeditor.getContentTxt(),$.post(zmf.autoMatchTagUrl,{content:a,YII_CSRF_TOKEN:zmf.csrfToken},function(a){ajaxReturn=!0,a=$.parseJSON(a),1===a.status?($("#add-tags-box").append(a.msg.html),simpleDialog({content:"已匹配"})):simpleDialog({content:a.msg})})}function setProductFaceimg(a,b,c,d){var e=$(b).children("i"),f=!1;e.hasClass("fa-bookmark")&&(f=!0),$(".right-bar").each(function(){$(this).find(".fa-bookmark").removeClass("fa-bookmark").addClass("fa-bookmark-o")}),f?a="":e.hasClass("fa-bookmark-o")?e.removeClass("fa-bookmark-o").addClass("fa-bookmark"):(e.removeClass("fa-bookmark").addClass("fa-bookmark-o"),a=""),$("#Products_faceImg").val(a),$("#product-avatar").attr("src",c)}var floatParams={};$(document).ready(function(){$(".delete").unbind("click").click(function(){if(stopDefault(),!confirm("确定？"))return!1;var a=$(this),b=a.attr("href"),c=a.attr("data-id"),d=a.attr("data-target"),e=a.attr("data-reload");return b?void $.post(b,{YII_CSRF_TOKEN:zmf.csrfToken},function(a){function b(){window.location.reload(),window.setTimeout("refreshPage()",1500)}ajaxReturn=!0,a=$.parseJSON(a),1===a.status?(simpleDialog({content:a.msg}),1===parseInt(e)?b():d?$("#"+d).remove():c&&$("#item-"+c).remove()):simpleDialog({content:a.msg})}):!1}),$(".ajax-submitLink").unbind("click").click(function(){if(stopDefault(),!confirm("确定？"))return!1;var a=$(this),b=a.attr("href");return b?void $.post(b,{YII_CSRF_TOKEN:zmf.csrfToken},function(a){ajaxReturn=!0,a=$.parseJSON(a),1===a.status?simpleDialog({content:a.msg}):simpleDialog({content:a.msg})}):!1})});