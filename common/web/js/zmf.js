/*Copyright JianJuKe.cn*/function rebind(){$("#site-info-holder").html($("#site-info-html").html()),$("#area-letternav a.area-letter").click(function(){stopDefault();var a=$(this).attr("data-offset");clearTimeout(letterTimeout),$("#area-body").animate({scrollTop:a-165},200)}),$("#area-letternav a.area-letter").mouseover(function(){var a=$(this).attr("data-offset");clearTimeout(letterTimeout),letterTimeout=setTimeout(function(){$("#area-body").animate({scrollTop:a-165},200)},150)}),$("#area-letternav a.area-letter").mouseout(function(){clearTimeout(letterTimeout)}),$("#site-info-toggle,#site-info-holder").mouseover(function(){clearTimeout(areaTimeout),areaTimeover=setTimeout(function(){$("#site-info-holder").show(),$("#area-letternav a.area-letter").each(function(){var a=$(this);if(!a.attr("data-offset")){var b=a.attr("href"),c=$("#navigation").offset().top;a.attr("data-offset",$(b).offset().top-c)}})},100)}),$("#site-info-toggle,#site-info-holder").mouseout(function(){clearTimeout(areaTimeover),areaTimeout=setTimeout(function(){$("#site-info-holder").hide()},300)}),$("img.lazy").lazyload({threshold:600,failure_limit:50,skip_invisible:!1}),$("#add-post-btn").unbind("click").click(function(){$(window).unbind("beforeunload")}),$(".sendSms-btn").unbind("click").click(function(){var dom=$(this),_target=dom.attr("data-target"),phone=$("#"+_target).val(),type=dom.attr("data-type");return _target?phone||"expasswd"===type?type?checkAjax()?void $.post(zmf.ajaxUrl,{action:"sendSms",type:type,phone:phone?phone:"",YII_CSRF_TOKEN:zmf.csrfToken},function(result){if(ajaxReturn=!0,result=eval("("+result+")"),1===result.status){var totalTime=60,times=0;dom.text("重新发送 "+totalTime+"s").attr("disabled","disabled");var interval=setInterval(function(){times+=1;var a=totalTime-times;dom.text("重新发送 "+a+"s"),0>=a&&(clearInterval(interval),dom.removeAttr("disabled").text("重新发送"))},1e3)}else simpleDialog({msg:result.msg})}):!1:(simpleDialog({msg:"缺少类型参数"}),!1):($("#"+_target).focus(),simpleDialog({msg:"请输入手机号"}),!1):(simpleDialog({msg:"请输入手机号"}),!1)}),zmf.remaindSendSmsTime>0&&$(".sendSms-btn").each(function(){var a=$(this),b=zmf.remaindSendSmsTime,c=0;a.text("重新发送 "+b+"s").attr("disabled","disabled");var d=setInterval(function(){c+=1;var e=b-c;a.text("重新发送 "+e+"s"),0>=e&&(clearInterval(d),a.removeAttr("disabled").text("重新发送"))},1e3)}),$("#login-btn").unbind("click").click(function(){var type=$("#login-type").val();if(!type||"passwd"!==type&&"sms"!==type)return simpleDialog({msg:"参数错误"}),!1;var phone=$("#login-phone").val();if(!phone)return simpleDialog({msg:"请输入手机号"}),!1;var validom=$("#validate-code"),value="";if("passwd"===type){if(value=$("#login-password").val(),!value)return simpleDialog({msg:"请输入密码"}),!1}else if("sms"===type){var valicode=validom.val();if(value=$("#login-code").val(),!value)return simpleDialog({msg:"请输入验证码"}),!1}return value?checkAjax()?void $.post(zmf.ajaxUrl,{action:"login",type:type,phone:phone,value:value,_valiCode:valicode,YII_CSRF_TOKEN:zmf.csrfToken},function(result){ajaxReturn=!0,result=eval("("+result+")"),1===result.status?window.location.href=result.msg:-9===result.status?(simpleDialog({msg:result.msg}),$("#validate-code-img").click()):simpleDialog({msg:result.msg})}):!1:(simpleDialog({msg:"缺少参数"}),!1)}),$("#login-phone,#reg-phone").keyup(function(){var a=$(this);a.val()?$(".sendSms-btn").removeClass("disabled").removeAttr("disabled"):$(".sendSms-btn").addClass("disabled").attr("disabled","disabled")}),$("#reg-btn").unbind("click").click(function(){var pdom=$("#reg-phone"),codedom=$("#reg-code"),unamedom=$("#reg-username"),passwddom=$("#reg-password"),validom=$("#validate-code"),phone=pdom.val();if(!phone)return pdom.focus(),simpleDialog({msg:"请输入常用手机号"}),!1;var valicode=validom.val(),code=codedom.val();if(!code)return codedom.focus(),simpleDialog({msg:"请输入验证码"}),!1;var name=unamedom.val();if(!name)return unamedom.focus(),simpleDialog({msg:"请输入昵称"}),!1;var passwd=passwddom.val();if(!passwd)return passwddom.focus(),simpleDialog({msg:"请输入密码"}),!1;if(passwd.length<6)return passwddom.focus(),simpleDialog({msg:"密码长度不短于6位"}),!1;if(!checkAjax())return!1;var passData={action:"reg",name:name,phone:phone,code:code,passwd:passwd,ucode:$("#reg-ucode").val(),_valiCode:valicode,YII_CSRF_TOKEN:zmf.csrfToken};$.post(zmf.ajaxUrl,passData,function(result){ajaxReturn=!0,result=eval("("+result+")"),1===result.status?window.location.href=result.msg:-9===result.status?(simpleDialog({msg:result.msg}),$("#validate-code-img").click()):simpleDialog({msg:result.msg})})}),$("#fixed-contact-us ._item").unbind("click").click(function(){var a=$(this),b=a.children("span"),c=a.attr("data-target");$("#fixed-contact-us ._item").each(function(){var a=$(this),b=a.children("span"),d=a.attr("data-target");d!==c&&"none"!==$("#"+d).css("display")&&($("#"+d).fadeOut(),b.removeClass("remove"))}),"none"!==$("#"+c).css("display")?($("#"+c).fadeOut(),b.removeClass("remove")):($("#"+c).fadeIn(),b.addClass("remove"))})}function searchKeyup(a,b){searchTimeOut(a,b);var c=a||window.event,d=c.target||c.srcElement;if(13==c.keyCode){if(-1!=navigator.userAgent.toUpperCase().indexOf("MSIE")&&lastv!=d.value)return lastv=d.value,!1;$(d).siblings("#search-btn").click()}else if((38==c.keyCode||40==c.keyCode)&&"block"==$("#JS_search_autocomplete").css("display")){var e=$("._search_item");e.removeClass("active"),e.eq(curr_suggitem).addClass("active"),$(c.target).val(e.eq(curr_suggitem).text()),curr_suggitem<e.length?curr_suggitem++:curr_suggitem=0}lastv=d.value}function hideSearch(){clearTimeout(search_keyup_t),search_keyup_t=setTimeout(function(){$("#JS_search_autocomplete").html("").hide()},500)}function showSearchPlaceholder(){$("#JS_search_autocomplete").html($("#JS_search_placeholder").html()).show()}function searchTimeOut(a,b){var c=a||window.event;clearTimeout(search_keyup_t),38!=c.keyCode&&40!=c.keyCode&&(search_keyup_t=setTimeout(function(){var a=$("#JS_search_keyword").val();if(!a)return showSearchPlaceholder(),!1;$("#JS_search_autocomplete").html("");var b={action:"search",keyword:a,YII_CSRF_TOKEN:zmf.csrfToken};$.post(zmf.ajaxUrl,b,function(a){a=$.parseJSON(a),ajaxReturn=!0,1===a.status?$("#JS_search_autocomplete").html(a.msg).show():hideSearch()})},500)),showSearchPlaceholder()}function myUploadify(){$("#uploadfile").uploadify({height:34,width:120,swf:zmf.baseUrl+"/common/uploadify/uploadify.swf",queueID:"fileQueue",auto:!0,multi:!0,fileObjName:"filedata",uploadLimit:zmf.perAddImgNum,fileSizeLimit:zmf.allowImgPerSize,fileTypeExts:zmf.allowImgTypes,fileTypeDesc:"Image Files",uploader:tipImgUploadUrl,buttonText:"请选择",buttonClass:"btn btn-success",debug:!1,formData:{PHPSESSID:zmf.currentSessionId,YII_CSRF_TOKEN:zmf.csrfToken},onUploadSuccess:function(file,data,response){if(data=eval("("+data+")"),1==data.status){var img="<p><img src='"+data.thumbnail+"' data='"+data.attachid+"' class='img-responsive'/></p>";if(myeditor.execCommand("inserthtml",img),$("#waitForAlt").length>0){var html='<div class="media"><div class="media-left"><img src="'+data.thumbnail+'"/></div><div class="media-body"><div class="form-group"><textarea class="form-control imgAlt" data-id="'+data.attachid+'" rows="4" placeholder="输入图片alt"></textarea></div></div></div>';$("#waitForAlt").append(html),rebind()}}else simpleDialog({content:data.msg});tipsImgOrder++}})}function uploadByLimit(a){if("object"!=typeof a)return!1;var b=!0;b="undefined"==typeof a.multi?!0:a.multi,$("#"+a.placeHolder).uploadify({height:a.height?a.height:100,width:a.width?a.width:300,swf:zmf.baseUrl+"/common/uploadify/uploadify.swf",queueID:a.queueID?a.queueID:"singleFileQueue",auto:!0,multi:b,queueSizeLimit:zmf.perAddImgNum,fileObjName:a.filedata?a.filedata:"filedata",fileTypeExts:zmf.allowImgTypes,fileSizeLimit:zmf.allowImgPerSize,fileTypeDesc:"Image Files",uploader:a.uploadUrl,buttonText:a.buttonText?a.buttonText:null===a.buttonText?"":"添加图片",buttonClass:a.buttonClass?a.buttonClass:"btn btn-default",debug:!1,formData:{PHPSESSID:zmf.currentSessionId,YII_CSRF_TOKEN:zmf.csrfToken},onSelect:function(a){},onUploadSuccess:function(b,c,d){c=$.parseJSON(c),1==c.status?(a.inputId&&$("#"+a.inputId).val(c.imgsrc),a.targetHolder&&$("#"+a.targetHolder).attr("src",c.thumbnail)):simpleDialog({content:c.msg})}})}function singleUploadify(a){if("object"!=typeof a)return!1;var b=!0;b="undefined"==typeof a.multi?!0:a.multi,$("#"+a.placeHolder).uploadify({height:a.height?a.height:100,width:a.width?a.width:300,swf:zmf.baseUrl+"/common/uploadify/uploadify.swf",queueID:"singleFileQueue",auto:!0,multi:b,queueSizeLimit:zmf.perAddImgNum,fileObjName:a.filedata?a.filedata:"filedata",fileTypeExts:zmf.allowImgTypes,fileSizeLimit:zmf.allowImgPerSize,fileTypeDesc:"Image Files",uploader:a.uploadUrl,buttonText:a.buttonText?a.buttonText:null===a.buttonText?"":"添加图片",buttonClass:a.buttonClass?a.buttonClass:"btn btn-default",debug:!1,formData:{PHPSESSID:zmf.currentSessionId,YII_CSRF_TOKEN:zmf.csrfToken},onUploadStart:function(b){if(a.saveItems){var c={},d=new Date,e=b.type,f=a.type+"/"+d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate()+"/"+uuid()+e;c.key=f,c.token=a.token,$("#"+a.placeHolder).uploadify("settings","formData",c)}},onUploadSuccess:function(b,c,d){if(c=$.parseJSON(c),a.saveItems){if(c.error)return alert(c.error),!1;var e={YII_CSRF_TOKEN:zmf.csrfToken,filePath:c.key,fileSize:b.size,type:a.type,logid:a.logid,action:"saveUploadImg"};$.post(zmf.ajaxUrl,e,function(b){return b=$.parseJSON(b),1!==b.status?(alert(b.msg),!1):($("#fileSuccess").append(b.html),a.inputId&&$("#"+a.inputId).val(b.attachid),rebind(),void 0)})}else{if(1!==c.status)return alert(c.msg),!1;$("#fileSuccess").html(c.html),a.inputId&&$("#"+a.inputId).val(c.attachid),rebind()}}})}function dialog(a){if("object"!=typeof a)return!1;var b=a.msg,c=a.id,d=a.title,e=a.action,f=a.actionName,g=a.time,h=a.modalSize;$("#"+beforeModal).modal("hide"),("undefined"==typeof d||""===d)&&(d="提示"),("undefined"==typeof c||""===c)&&(c="myDialog"),"undefined"==typeof e&&(e=""),"undefined"==typeof h&&(h=""),$("#"+c).remove();var i='<div class="modal fade mymodal" id="'+c+'" tabindex="-1" role="dialog" aria-labelledby="'+c+'Label" aria-hidden="true"><div class="modal-dialog '+h+'"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="'+c+'Label">'+d+'</h4></div><div class="modal-body">'+b+'</div><div class="modal-footer">';if(i+='<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>',""!==e&&"undefined"!=typeof e){var j;j=""!==f&&"undefined"!=typeof f?f:"确定",i+='<button type="button" class="btn btn-primary" action="'+e+'" data-loading-text="Loading...">'+j+"</button>"}i+="</div></div></div></div>",$("body").append(i),$("#"+c).modal({backdrop:!1,keyboard:!1}),beforeModal=c,g>0&&"undefined"!=typeof g&&setTimeout("closeDialog('"+c+"')",1e3*g)}function closeDialog(a){a||(a="myDialog"),$("#"+a).modal("hide"),$("#"+a).remove(),$("body").eq(0).removeClass("modal-open")}function simpleDialog(a){if("object"!=typeof a)return!1;var b=a.content||a.msg,c='<div class="simpleDialog '+(1===a.status?"succDialog":"errDialog")+'">'+b+"</div>";$("body").append(c);var d=$(".simpleDialog"),e=d.width(),f=d.height();d.css({"margin-left":-e/2,"margin-top":-f/2}),d.fadeIn(300),setTimeout("closeSimpleDialog()",2700)}function closeSimpleDialog(){$(".simpleDialog").fadeOut(100).remove()}function checkAjax(){return ajaxReturn?(ajaxReturn=!1,!0):(simpleDialog({content:"请求正在发送中，请稍后"}),!1)}function checkLogin(){return"undefined"==typeof zmf.hasLogin?!1:"true"===zmf.hasLogin?!0:!1}function backToTop(){var a=$(window).width(),b=($("#back-to-top").width(),parseInt((a+16)/2));$("#back-to-top").css("left",b+"px");var c=$(window).height(),d=$(document.body).height();c>d&&$("body").css("height",c),$("#footer-bg").fadeIn(3e3)}function uuid(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19===c?3&f|8:f])}return e.join("")}function stopDefault(a){return a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,!1}function showLogin(){var a=zmf.regAndLogin;return 1!=a?!1:void $.post(zmf.ajaxUrl,{action:"checkLoginHtml",YII_CSRF_TOKEN:zmf.csrfToken},function(a){return ajaxReturn=!0,a=$.parseJSON(a),1===a.status?$("#JS_navbar_login").html(a.msg).show():$("#JS_navbar_login").show(),!1})}var tipsImgOrder=0,beforeModal,ajaxReturn=!0,_topNavTimer,navTimeout,navTimeover,areaTimeout,areaTimeover,letterTimeout,curr_suggitem=0,lastv="",search_keyup_t,url=window.location.href;$(window).scroll(function(){$(window).scrollTop()>100?$(".back-to-top").css({display:"block"}):$(".back-to-top").fadeOut();var a=$("#navigation"),b=a.height();$(window).scrollTop()>b?a.addClass("navbar-shadow"):a.removeClass("navbar-shadow")}),$(".back-to-top").click(function(){return $("body,html").animate({scrollTop:0},200),!1}),$(window).resize(function(){backToTop()}),backToTop(),!function(a,b,c,d){var e=a(b);a.fn.lazyload=function(f){function g(){var b=0;i.each(function(){var c=a(this);if(!j.skip_invisible||c.is(":visible"))if(a.abovethetop(this,j)||a.leftofbegin(this,j));else if(a.belowthefold(this,j)||a.rightoffold(this,j)){if(++b>j.failure_limit)return!1}else c.trigger("appear"),b=0})}var h,i=this,j={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:!1,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return f&&(d!==f.failurelimit&&(f.failure_limit=f.failurelimit,delete f.failurelimit),d!==f.effectspeed&&(f.effect_speed=f.effectspeed,delete f.effectspeed),a.extend(j,f)),h=j.container===d||j.container===b?e:a(j.container),0===j.event.indexOf("scroll")&&h.bind(j.event,function(){return g()}),this.each(function(){var b=this,c=a(b);b.loaded=!1,(c.attr("src")===d||c.attr("src")===!1)&&c.is("img")&&c.attr("src",j.placeholder),c.one("appear",function(){if(!this.loaded){if(j.appear){var d=i.length;j.appear.call(b,d,j)}a("<img />").bind("load",function(){var d=c.attr("data-"+j.data_attribute);c.hide(),c.is("img")?c.attr("src",d):c.css("background-image","url('"+d+"')"),c[j.effect](j.effect_speed),b.loaded=!0;var e=a.grep(i,function(a){return!a.loaded});if(i=a(e),j.load){var f=i.length;j.load.call(b,f,j)}}).attr("src",c.attr("data-"+j.data_attribute))}}),0!==j.event.indexOf("scroll")&&c.bind(j.event,function(){b.loaded||c.trigger("appear")})}),e.bind("resize",function(){g()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&e.bind("pageshow",function(b){b.originalEvent&&b.originalEvent.persisted&&i.each(function(){a(this).trigger("appear")})}),a(c).ready(function(){g()}),this},a.belowthefold=function(c,f){var g;return g=f.container===d||f.container===b?(b.innerHeight?b.innerHeight:e.height())+e.scrollTop():a(f.container).offset().top+a(f.container).height(),g<=a(c).offset().top-f.threshold},a.rightoffold=function(c,f){var g;return g=f.container===d||f.container===b?e.width()+e.scrollLeft():a(f.container).offset().left+a(f.container).width(),g<=a(c).offset().left-f.threshold},a.abovethetop=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollTop():a(f.container).offset().top,g>=a(c).offset().top+f.threshold+a(c).height()},a.leftofbegin=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollLeft():a(f.container).offset().left,g>=a(c).offset().left+f.threshold+a(c).width()},a.inviewport=function(b,c){return!(a.rightoffold(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.abovethetop(b,c))},a.extend(a.expr[":"],{"below-the-fold":function(b){return a.belowthefold(b,{threshold:0})},"above-the-top":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-screen":function(b){return a.rightoffold(b,{threshold:0})},"left-of-screen":function(b){return!a.rightoffold(b,{threshold:0})},"in-viewport":function(b){return a.inviewport(b,{threshold:0})},"above-the-fold":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-fold":function(b){return a.rightoffold(b,{threshold:0})},"left-of-fold":function(b){return!a.rightoffold(b,{threshold:0})}})}(jQuery,window,document),rebind(),showLogin();