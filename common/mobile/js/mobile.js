/*Copyright JianJuKe.cn*/function rebind(){if($("img.lazy").lazyload({threshold:600}),$("a[action=getContents]").unbind("tap").tap(function(){var a=$(this),b=a.attr("data-id"),c=a.attr("data-type"),d=a.attr("data-page"),e=a.attr("data-target");if(!e)return!1;if("1"===a.attr("data-loaded"))return $("#"+e+"-box").hide(),a.attr("data-loaded",0),!1;d||(d=1);var f='<div class="loading-holder"><a class="btn btn-default disabled" href="javascript:;">拼命加载中...</a></div>';$("#"+e).children(".loading-holder").each(function(){$(this).remove()}),$("#"+e).append(f),$("#"+e+"-box").show(),$.post(zmf.ajaxUrl,{action:"getContents",type:c,page:d,data:b,YII_CSRF_TOKEN:zmf.csrfToken},function(f){if(ajaxReturn=!0,a.attr("data-loaded",1),f=$.parseJSON(f),1===f.status){var g=f.msg,h="",i="";if(""!==g.html&&(i+=g.html),1===g.loadMore){var j=parseInt(d)+1;h+='<div class="loading-holder"><a class="btn btn-default"  href="javascript:;" action="getContents" data-type="'+c+'" data-id="'+b+'" data-page="'+j+'" data-target="'+e+'">加载更多</a></div>'}else h+=""===g.html&&1===d?"":'<div class="loading-holder"><a class="btn btn-default disabled" href="javascript:;">已全部加载</a></div>';$("#"+e+" .loading-holder").each(function(){$(this).remove()}),d>1?$("#"+e).append(i):(""===g.html&&(i='<div class="help-block text-center">暂无内容</div>'),$("#"+e).html(i)),$("#"+e).append(h),1===d&&$("#"+e+"-form").html(g.formHtml),rebind()}else simpleDialog({content:f.msg})})}),$("a[action=ajax-contents]").unbind("tap").tap(function(){var a=$(this);ajaxContents(a)}),$("a[action=scroll]").unbind("tap").tap(function(){var a=$(this),b=a.attr("action-target");return b?void $("body,html").animate({scrollTop:$("#"+b).offset().top},200):!1}),$(".showContact").unbind("tap").tap(function(){$("#JS_contact_holder").toggle(),stopDefault()}),$("#JS_contact_close").unbind("tap").tap(function(){$("#JS_contact_holder").hide(),stopDefault()}),$("#sendSms-btn").unbind("tap").tap(function(){var dom=$(this),_target=dom.attr("data-target");if(!_target)return simpleDialog({msg:"请输入手机号"}),!1;var phone=$("#"+_target).val();if(!phone)return $("#"+_target).focus(),simpleDialog({msg:"请输入手机号"}),!1;var type=dom.attr("data-type");if(!type)return simpleDialog({msg:"缺少类型参数"}),!1;if("login"===type||"reg"===type)var validom=$("#validate-code"),valicode=validom.val();return checkAjax()?void $.post(zmf.ajaxUrl,{action:"sendSms",type:type,phone:phone,valicode:valicode,YII_CSRF_TOKEN:zmf.csrfToken},function(result){if(ajaxReturn=!0,result=eval("("+result+")"),1===result.status){var totalTime=60,times=0;dom.text("重新发送 "+totalTime+"s").attr("disabled","disabled");var interval=setInterval(function(){times+=1;var a=totalTime-times;dom.text("重新发送 "+a+"s"),0>=a&&(clearInterval(interval),dom.removeAttr("disabled").text("重新发送"))},1e3)}else simpleDialog({msg:result.msg})}):!1}),zmf.remaindSendSmsTime>0){var dom=$("#sendSms-btn"),totalTime=zmf.remaindSendSmsTime,times=0;dom.text("重新发送 "+totalTime+"s").attr("disabled","disabled");var interval=setInterval(function(){times+=1;var a=totalTime-times;dom.text("重新发送 "+a+"s"),0>=a&&(clearInterval(interval),dom.removeAttr("disabled").text("重新发送"))},1e3)}$("#login-btn").unbind("tap").tap(function(){var type=$("#login-type").val();if(!type||"passwd"!==type&&"sms"!==type)return simpleDialog({msg:"参数错误"}),!1;var phone=$("#login-phone").val();if(!phone)return simpleDialog({msg:"请输入手机号"}),!1;var validom=$("#validate-code"),value="";if("passwd"===type){if(value=$("#login-password").val(),!value)return $("#login-password").focus(),simpleDialog({msg:"请输入密码"}),!1}else if("sms"===type){var valicode=validom.val();if(value=$("#login-code").val(),!value)return $("#login-code").focus(),simpleDialog({msg:"请输入验证码"}),!1}if(!value)return simpleDialog({msg:"缺少参数"}),!1;var bind=$("#login-bind").val();return bind&&"undefined"!=typeof bind||(bind=""),checkAjax()?void $.post(zmf.ajaxUrl,{action:"login",type:type,phone:phone,value:value,_valiCode:valicode,bind:bind,YII_CSRF_TOKEN:zmf.csrfToken},function(result){ajaxReturn=!0,result=eval("("+result+")"),1===result.status?window.location.href=result.msg:-9===result.status?(simpleDialog({msg:result.msg}),$("#validate-code-img").click()):simpleDialog({msg:result.msg})}):!1}),$("#reg-btn").unbind("tap").tap(function(){var pdom=$("#reg-phone"),codedom=$("#reg-code"),unamedom=$("#reg-username"),passwddom=$("#reg-password"),validom=$("#validate-code"),phone=pdom.val();if(!phone)return pdom.focus(),simpleDialog({msg:"请输入常用手机号"}),!1;var valicode=validom.val(),code=codedom.val();if(!code)return codedom.focus(),simpleDialog({msg:"请输入验证码"}),!1;var name=unamedom.val();if(!name)return unamedom.focus(),simpleDialog({msg:"请输入昵称"}),!1;var passwd=passwddom.val();if(!passwd)return passwddom.focus(),simpleDialog({msg:"请输入密码"}),!1;if(passwd.length<6)return passwddom.focus(),simpleDialog({msg:"密码长度不短于6位"}),!1;var bind=$("#reg-bind").val();if(bind&&"undefined"!=typeof bind||(bind=""),!checkAjax())return!1;var passData={action:"reg",name:name,phone:phone,code:code,passwd:passwd,ucode:$("#reg-ucode").val(),_valiCode:valicode,bind:bind,YII_CSRF_TOKEN:zmf.csrfToken};$.post(zmf.ajaxUrl,passData,function(result){ajaxReturn=!0,result=eval("("+result+")"),1===result.status?window.location.href=result.msg:-9===result.status?(simpleDialog({msg:result.msg}),$("#validate-code-img").click()):simpleDialog({msg:result.msg})})}),$(".sendSms-btn").unbind("tap").tap(function(){var dom=$(this),_target=dom.attr("data-target");if(!_target)return simpleDialog({content:"请输入手机号"}),!1;var phone=$("#"+_target).val();if(!phone)return simpleDialog({content:"请输入手机号"}),!1;var type=dom.attr("data-type");return type?void $.post(zmf.ajaxUrl,{action:"sendSms",type:type,phone:phone,YII_CSRF_TOKEN:zmf.csrfToken},function(result){if(result=eval("("+result+")"),1===result.status){var totalTime=60,times=0;dom.text("重新发送 "+totalTime+"s").attr("disabled","disabled");var interval=setInterval(function(){times+=1;var a=totalTime-times;dom.text("重新发送 "+a+"s"),0>=a&&(clearInterval(interval),dom.removeAttr("disabled").text("重新发送"))},1e3);$("#forgot-hidden").show()}else simpleDialog({content:result.msg})}):(simpleDialog({content:"缺少类型参数"}),!1)})}function showNavDia(){$("#JS_fixed_nav_holder").show().animate({right:0})}function closeNavDia(){var a=$("#JS_fixed_nav_holder");a.animate({right:"-1000px"},300,"linear")}function getContents(a){var b=a.attr("action-data"),c=a.attr("action-type"),d=a.attr("action-page"),e=a.attr("action-target");if(!checkAjax())return!1;if(!e)return!1;d||(d=1);var f="",g="";"magazine"===zmf.module?f="btn btn-default btn-block":(f="ui-btn-lg",g="ui-btn-wrap");var h='<div class="loading-holder '+g+'"><a class="'+f+' disabled" href="javascript:;">拼命加载中...</a></div>';$("#"+e+"-box").children(".loading-holder").each(function(){$(this).remove()}),$("#"+e+"-box").append(h),$.post(zmf.contentsUrl,{type:c,page:d,data:b,YII_CSRF_TOKEN:zmf.csrfToken},function(h){if(ajaxReturn=!0,a.attr("loaded","1"),h=$.parseJSON(h),1===h.status){var i=h.msg,j="",k="";if(""!==i.html&&(k+=i.html),1===i.loadMore){var l=parseInt(d)+1;j+='<div class="loading-holder '+g+'"><a class="'+f+'"  href="javascript:;" action="get-contents" action-type="'+c+'" action-data="'+b+'" action-page="'+l+'" action-target="'+e+'">加载更多</a></div>'}else j+='<div class="loading-holder '+g+'"><a class="'+f+' disabled" href="javascript:;">已全部加载</a></div>';1===d?($("#"+e+"-box").append(i.formHtml),$("#"+e+"-box .loading-holder").each(function(){$(this).remove()})):$("#"+e+"-box .loading-holder").each(function(){$(this).remove()}),d>1?$("#"+e).append(k):$("#"+e).html(k),$("#"+e+"-box").append(j),rebind()}else simpleDialog({content:h.msg})})}function ajaxContents(a){stopDefault();var b=a.attr("action-page"),c=a.attr("action-target"),d=a.attr("href");if(!c||!d)return!1;b||(b=1);var e='<div class="loading-holder"><a class="btn btn-default" href="javascript:;"><i class="weui-loading"></i> 拼命加载中...</a></div>';$("#"+c+"-box").children(".loading-holder").each(function(){$(this).remove()}),$("#"+c+"-box").append(e),$.post(d,{page:b,YII_CSRF_TOKEN:zmf.csrfToken},function(d){if(ajaxReturn=!0,a.attr("loaded","1"),d=$.parseJSON(d),1===d.status){var e=d.msg,f="",g="";if(""!==e.html&&(g+=e.html),1===e.loadMore){var h=parseInt(b)+1;f+='<div class="loading-holder"><a class="btn btn-default"  href="'+e.url+'" action="ajax-contents" action-page="'+h+'" action-target="'+c+'">加载更多</a></div>'}else f+='<div class="loading-holder"><a class="btn btn-default" href="javascript:;">已全部加载</a></div>';1===b?($("#"+c+"-box").append(e.formHtml),$("#"+c+"-box .loading-holder").each(function(){$(this).remove()})):$("#"+c+"-box .loading-holder").each(function(){$(this).remove()}),b>1?$("#"+c).append(g):$("#"+c).html(g),$("#"+c+"-box").append(f),rebind()}else simpleDialog({content:d.msg})})}function closeConfirmDialog(){var a=$("#confirmDialog");a.fadeOut(200)}function confirmDialog(a){if("object"!=typeof a)return!1;closeConfirmDialog();var b='<div id="confirmDialog"><div class="weui-mask"></div><div class="weui-dialog"><div class="weui-dialog__hd"><strong class="weui-dialog__title">'+a.title+'</strong></div><div class="weui-dialog__bd">'+a.content+'</div><div class="weui-dialog__ft"><a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default" onClick="closeConfirmDialog()">'+a.cancelTitle+'</a><a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" id="_confirm_dialog_confirm">'+a.confirmTitle+"</a></div></div></div>",c=$("#confirmDialog");c.length>0&&c.remove(),$("body").append(b),c.fadeIn(200),$("#_confirm_dialog_confirm").on("tap",a.confirmFunc)}function closeActionsSheet(a){stopDefault(a);var b=$("#iosActionsheet"),c=$("#iosMask");b.removeClass("weui-actionsheet_toggle"),c.fadeOut(200)}function showActionsSheet(a){function b(){stopDefault(),d.removeClass("weui-actionsheet_toggle"),e.fadeOut(200)}if("object"!=typeof a)return!1;stopDefault(),closeActionsSheet();var c='<div class="weui-mask" id="iosMask" style="display: none;"></div><div class="weui-actionsheet" id="iosActionsheet"><div class="weui-actionsheet__title"><p class="weui-actionsheet__title-text">'+a.title+'</p></div><div class="weui-actionsheet__menu">'+a.actions+'</div><div class="weui-actionsheet__action"><div class="weui-actionsheet__cell" id="iosActionsheetCancel">取消</div></div></div>',d=$("#iosActionsheet"),e=$("#iosMask");d.length>0&&(d.remove(),e.remove()),$("body").append(c);var d=$("#iosActionsheet"),e=$("#iosMask");e.on("tap",b),$("#iosActionsheetCancel").on("tap",b),d.addClass("weui-actionsheet_toggle"),e.fadeIn(200)}function showLoading(){var a='<div id="loadingToast" style="display: none;"><div class="weui-mask_transparent"></div><div class="weui-toast"><i class="weui-loading weui-icon_toast"></i><p class="weui-toast__content">数据加载中</p></div></div>',b=$("#loadingToast");b.length>0&&b.remove(),$("body").append(a);var b=$("#loadingToast");"none"===b.css("display")&&(b.fadeIn(100),setTimeout(function(){b.fadeOut(100)},2e3))}function closeLoading(){$("#loadingToast").fadeOut(100)}function dialog(a){if("object"!=typeof a)return!1;closeSimpleDialog();var b=a.msg,c='<div class="simpleDialog '+(1===a.status?"succDialog":"errDialog")+'" id="simpleDialog">'+b+"</div>";$("body").append(c);var d=$("#simpleDialog"),e=d.width(),f=d.height();d.css({"margin-left":-e/2,"margin-top":-f/2}),d.fadeIn(300),setTimeout("closeSimpleDialog()",2700)}function closeSimpleDialog(){$("#simpleDialog").fadeOut(100).remove()}function scollToComment(){$(".toggle-area").each(function(){$(this).fadeIn(500)});var a=($(window).height(),$(".comment-textarea").offset().top);$("body,html").animate({scrollTop:a},200)}function simpleDialog(a){if("object"!=typeof a)return!1;closeSimpleDialog();var b=a.content||a.msg,c='<div class="simpleDialog errDialog">'+b+"</div>";$("body").append(c);var d=$(".simpleDialog"),e=d.width(),f=d.height();d.css({"margin-left":-e/2,"margin-top":-f/2}),d.fadeIn(300),setTimeout("closeSimpleDialog()",2700)}function getNotice(){doGetNotice(),window.setInterval("doGetNotice()",1e4)}function doGetNotice(){return checkLogin()?void $.post(zmf.ajaxUrl,{action:"getNotice",YII_CSRF_TOKEN:zmf.csrfToken},function(a){if(a=$.parseJSON(a),1===a.status){var b=parseInt(a.msg);b>0?($("#top-nav-count").html(b).css("display","inline-block"),null===flashTitle.timer&&flashTitle.show()):($("#top-nav-count").hide(),flashTitle.clear())}}):!1}function closeSimpleDialog(){$(".simpleDialog").fadeOut(100).remove()}function checkAjax(){return ajaxReturn?(ajaxReturn=!1,!0):(simpleDialog({content:"请求正在发送中，请稍后"}),!1)}function stopDefault(a){return a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,!1}function simpleLoading(a){if("object"!=typeof a)return!1;var b=a.title,c='<div class="simple-loading-box"><div class="loading-holder"><i class="fa fa-spinner"></i></div><div class="loading-title"><p>'+b+"</p></div></div>";$("body").append(c);var d=$(".simple-loading-box"),e=d.width(),f=d.height();d.css({"margin-left":-e/2,"margin-top":-f/2}),d.fadeIn(300),setTimeout("closeSimpleLoading()",2700)}function closeSimpleLoading(){$(".simple-loading-box").fadeOut(100).remove()}function checkLogin(){return"undefined"==typeof zmf.hasLogin?!1:"true"===zmf.hasLogin?!0:!1}function uuid(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19===c?3&f|8:f])}return e.join("")}var ajaxReturn=!0,beforeModal,flashTitle={time:0,title:document.title,timer:null,show:function(){var a=flashTitle.title.replace("【　　　】","").replace("【新消息】","");return flashTitle.timer=setTimeout(function(){flashTitle.time++,flashTitle.show(),flashTitle.time%2==0?document.title="【新消息】"+a:document.title="【　　　】"+a},600),[flashTitle.timer,flashTitle.title]},clear:function(){clearTimeout(flashTitle.timer),document.title=flashTitle.title}};!function(a,b,c,d){var e=a(b);a.fn.lazyload=function(c){function f(){var b=0;h.each(function(){var c=a(this);if(!i.skip_invisible||"none"!==c.css("display"))if(a.abovethetop(this,i)||a.leftofbegin(this,i));else if(a.belowthefold(this,i)||a.rightoffold(this,i)){if(++b>i.failure_limit)return!1}else c.trigger("appear"),b=0})}var g,h=this,i={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:!0,appear:null,load:null};return c&&(d!==c.failurelimit&&(c.failure_limit=c.failurelimit,delete c.failurelimit),d!==c.effectspeed&&(c.effect_speed=c.effectspeed,delete c.effectspeed),a.extend(i,c)),g=i.container===d||i.container===b?e:a(i.container),0===i.event.indexOf("scroll")&&g.on(i.event,function(){return f()}),this.each(function(){var b=this,c=a(b);b.loaded=!1,c.one("appear",function(){if(!this.loaded){if(i.appear){var d=h.length;i.appear.call(b,d,i)}a("<img />").on("load",function(){var d,e;c.hide().attr("src",c.data(i.data_attribute))[i.effect](i.effect_speed),b.loaded=!0,d=a.grep(h,function(a){return!a.loaded}),h=a(d),i.load&&(e=h.length,i.load.call(b,e,i))}).attr("src",c.data(i.data_attribute))}}),0!==i.event.indexOf("scroll")&&c.on(i.event,function(){b.loaded||c.trigger("appear")})}),e.on("resize",function(){f()}),/iphone|ipod|ipad.*os 5/gi.test(navigator.appVersion)&&e.on("pageshow",function(b){b=b.originalEvent||b,b.persisted&&h.each(function(){a(this).trigger("appear")})}),a(b).on("load",function(){f()}),this},a.belowthefold=function(c,f){var g;return g=f.container===d||f.container===b?e.height()+e.scrollTop():a(f.container).offset().top+a(f.container).height(),g<=a(c).offset().top-f.threshold},a.rightoffold=function(c,f){var g;return g=f.container===d||f.container===b?e.width()+e[0].scrollX:a(f.container).offset().left+a(f.container).width(),g<=a(c).offset().left-f.threshold},a.abovethetop=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollTop():a(f.container).offset().top,g>=a(c).offset().top+f.threshold+a(c).height()},a.leftofbegin=function(c,f){var g;return g=f.container===d||f.container===b?e[0].scrollX:a(f.container).offset().left,g>=a(c).offset().left+f.threshold+a(c).width()},a.inviewport=function(b,c){return!(a.rightoffold(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.abovethetop(b,c))},a.extend(a.fn,{"below-the-fold":function(b){return a.belowthefold(b,{threshold:0})},"above-the-top":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-screen":function(b){return a.rightoffold(b,{threshold:0})},"left-of-screen":function(b){return!a.rightoffold(b,{threshold:0})},"in-viewport":function(b){return a.inviewport(b,{threshold:0})},"above-the-fold":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-fold":function(b){return a.rightoffold(b,{threshold:0})},"left-of-fold":function(b){return!a.rightoffold(b,{threshold:0})}})}($,window,document),function(a){"use strict";a.fn.pin=function(b){var c=0,d=[],e=!1,f=a(window);b=b||{};var g=function(){for(var c=0,g=d.length;g>c;c++){var h=d[c];if(b.minWidth&&f.width()<=b.minWidth)h.parent().is(".pin-wrapper")&&h.unwrap(),h.css({width:"",left:"",top:"",position:""}),b.activeClass&&h.removeClass(b.activeClass),e=!0;else{e=!1;var i=b.containerSelector?h.closest(b.containerSelector):a(document.body),j=h.offset(),k=i.offset(),l=h.offsetParent().offset();h.parent().is(".pin-wrapper")||h.wrap("<div class='pin-wrapper'>");var m=a.extend({top:0,bottom:0},b.padding||{});h.data("pin",{pad:m,from:(b.containerSelector?k.top:j.top)-m.top,to:k.top+i.height()-h.outerHeight()-m.bottom,end:k.top+i.height(),parentTop:l.top}),h.css({width:h.outerWidth()}),h.parent().css("height",h.outerHeight())}}},h=function(){if(!e){c=f.scrollTop();for(var g=[],h=0,i=d.length;i>h;h++){var j=a(d[h]),k=j.data("pin");if(k){g.push(j);var l=k.from-k.pad.bottom,m=k.to-k.pad.top;l+j.outerHeight()>k.end?j.css("position",""):c>l&&m>c?(!("fixed"==j.css("position"))&&j.css({left:j.offset().left,top:k.pad.top}).css("position","fixed"),b.activeClass&&j.addClass(b.activeClass)):c>=m?(j.css({left:"",top:m-k.parentTop+k.pad.top}).css("position","absolute"),b.activeClass&&j.addClass(b.activeClass)):(j.css({position:"",top:"",left:""}),b.activeClass&&j.removeClass(b.activeClass))}}d=g}},i=function(){g(),h()};return this.each(function(){var b=a(this),c=a(this).data("pin")||{};c&&c.update||(d.push(b),a("img",this).one("load",g),c.update=i,a(this).data("pin",c))}),f.scroll(h),f.resize(function(){g()}),g(),f.load(i),this}}(jQuery),rebind();